language: php

php:
  - 5.6

branches:
  only:
    - staging
    - master

build:
  ci:
    # Get the latest image to reuse its cache. Will not work with Docker 1.10 . Docker 1.13 adds support with --cache-from flag
    - docker pull nrgi/rc-admin:$BRANCH
    
    - docker build -t nrgi/rc-admin:$BRANCH.$COMMIT .
    # Create the `latest` tag and force it in case the tag is already there from a previous build
    - docker tag -f nrgi/rc-admin:$BRANCH.$COMMIT nrgi/rc-admin:$BRANCH
  
    - docker push nrgi/rc-admin:$BRANCH
    - docker push nrgi/rc-admin:$BRANCH.$COMMIT

integrations:
  hub:
    - integrationName: nrgiDockerHub
      type: docker
  notifications:
    - integrationName: email
      type: email
      recipients:
        - nrgi@vitaminsoftware.com
        - resourcecontracts@yipl.com.np
      branches:
        only:
          - master
          - staging
      on_success: change
      on_failure: always
